# Item 23. 태그 달린 클래스보다는 클래스 계층구조를 활용하라

한 클래스가 여러 의미를 가지도록 하는 태그 필드를 사용할때가 있을 것이다.

```java
public class Figure {
    enum Shape { RECTANGLE, CIRCLE };

    // 태그 필드 - 현재 모양을 나타낸다.
    final Shape shape;

    // 다음 필드들은 모양이 사각형(RECTANGLE)일 때만 쓰인다.
    double length;
    double width;

    // 다음 필드는 모양이 원(CIRCLE)일 때만 쓰인다.
    double radius;

  ...
```

간단하게 나타내면 다음과 같은데, 이 구조는 단점이 매우 많다.

이넘타입, 태그 필드, 각자 생성자, 메서드 분기등 불필요한 코드가 매우 많다.

이 불필요한 코드는 메모리 낭비와 직결되는데, 한 타입을 사용하는 경우 다른 타입 관련 코드는 모두 낭비인 셈이다. (객체가 무겁다, 불변 필드인 경우 모두 null로 지정해줘야 한다.)

이 불필요한 코드에 대해 컴파일러는 전혀 알 수 없고, 런타임이 되어서야 알 수 있는데 개발 생산성을 저하시키는 좋은 요인이다.

태그 달린 클래스는 계층 구조로 바꾸면 위의 문제점이 사라진다.

순서는 다음과 같다.

1. 계층 구조의 공통되는 부분을 추상 클래스를 정의한다. 여기서 분기되는 메서드의 경우 추상 메서드로 선언
2. 각 태그에 해당하는 클래스를 만들어 추상 클래스를 구현한다.

이와 같이 분리하게 되면, 각자 필요한 코드만 가져가기 때문에 객체는 더욱 가벼지고, 컴파일러가 잡아주기 때문에 개발 생산성도 올라가게 된다. → 객체가 가벼워 진다.

### 마무리

컴파일 에러가 가장 좋은 에러라는 말이 있다. 컴파일러를 최대한 활용할 수 있는 개발을 해야 생산성이 올라갈 것이다.

이번 아이템은 뭔가 당연한 얘기를 하는 기분이다. 한 객체에서 N개의 객체처럼 사용하려 하면 큰 탈이 있다.

여기서 제안한 방법으로 추상 클래스를 말했는데, 직전에 5개의 아이템에서 강조된 내용을 보면 추상 클래스를 사용할 때 설계를 각별히 신경써야 한다는 얘기를 했었다. 공통되는 추상 클래스를 정의할 때 정말 공통되는지 당장만 공통되고 변경될 여지가 있는지 Is~A 관계를 확인하라 라는 말이 있듯이 이 부분을 신경써서 분리해야 하지 않을까.
