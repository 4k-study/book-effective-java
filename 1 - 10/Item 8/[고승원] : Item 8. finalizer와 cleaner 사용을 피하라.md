# Item 8. finalizer와 cleaner 사용을 피하라

finalizer는 예측할 수 없고, 상황에 따라 위험하여 자바 9부터 Deplicated되었다. 그 대안으로 나온 Cleaner 또한 위험성이 있고, 느리기 때문에 일반적으로 사용하지 않는다.

다른 언어에서 자원을 사용한 후 반환할때 사용하겠지만 자바는 try with resource 가 있기 때문에 필요없다.

finalizer와 cleaner는 객체의 접근이 불가능하게 된 뒤 언제 실행되는지, 실행여부 조차 알 수 없다. 따라서 파일 닫기등을 제때 실행하지 못해 중대한 오류가 일어날 수 있다.

finalizer를 회수하는 스레드는 우선순위가 낮아서 실행하지 못해 인스턴스가 계속 남아있게 되는데 이는 OutOfMemory를 초래한다.

그럼에도 finalizer와 cleaner 를 사용하는데, 이는 어떻게든 자원 회수를 하는 것이 안하는 것보다 좋기 때문에 사용한다. 그리고, 네이티브 피어와 연결된 객체에서도 사용한다.

네이티브 피어란 일반 자바 객체가 네이티브 메서드를 통해 기능을 위임한 네이티브 피어 객체를 뜻한다.

네이티브 피어 객체는 자바 객체가 아니라 GC가 알지못해 회수할 수 없어서 finalier나 cleaner로 처리한다.

### finalizer

자바 객체의 최상단인 Object의 메서드이며, 일반적으로 JVM의 스레드에서 더이상 접근할 수 없을때 GC에서 호출된다. 하위 클래스는 시스템 리소스를 처분하거나 다른 로직을 수행하기 위해 finalizer를 Override 하기도 한다.

finalizer중 발생된 예외는 무시되고 finalizer를 종료시킨다. 이는 객체 반환이 완벽하게 이루어지지 않을 수 있고, 에러로그를 반환하지도 않는다. (cleaner는 이런 문제가 없음)

또한 finalizer는 try-with-resource보다 50배정도 느리다.

인스턴스 생성과정, 직렬화 과정중 예외가 발생하면 이 불완전한 객체의 하위 finalizer가 수행될 수 있다. 이때 정적 필드에 자신을 할당하면 GC의 대상이 되지도 않는다.

### cleaner

각 cleaner는 독립적으로 작동하여 작업을 관리하고 cleaner가 더 이상 사용되지 않을 때 스레드화 및 종료한다. 

가장 효율적인 사용은 객체가 더 이상 필요하지 않을 때 Clean 메서드를 명시적으로 호출하는 것이다. 

clean 과정에 의해 던져진 모든 예외는 무시되어, cleaner및 다른 clean 동작의 예외에 의해 영향을 받지 않는다. 

System.exit 중 cleaner의 동작은 구현에 따라 다르기에 실행 여부와 관련하여 보장되지 않는다.

### 마무리

finalizer와 cleaner는 안전망 정도로만 사용하자, 이는 느리고 활동이 보장되지 않기 때문에 불안정하기 때문이다.
