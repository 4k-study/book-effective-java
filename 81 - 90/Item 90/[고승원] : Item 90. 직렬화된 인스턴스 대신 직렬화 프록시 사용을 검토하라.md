# Item 90. 직렬화된 인스턴스 대신 직렬화 프록시 사용을 검토하라.

지금까지 Serializable의 위험성을 많이 언급했다. 이를 피하려면 직렬화 프록시 패턴을 사용하는 것도 좋다.

### 구현

- 바깥 클래스의 논리적 상태를 정밀하게 표현하는 중첩 클래스를 private static으로 선언한다.
- 생성자는 하나여야 하고, 바깥 클래스를 매개변수로 받는다.
- 생성자는 단순히 인수로 넘어온 인스턴스의 데이터를 복사한다.
- 바깥 클래스, 직렬화 프록시 모두 Serializable을 구현한다.
- 바깥 클래스에서 writeReplace 메서드를 추가한다.

직렬화 프록시 패턴은, 직렬화가 이루어지기 전에 인스턴스를 직렬화 프록시로 변환해준다. 

### 주의점

- 바깥 클래스에 readObject 메서드를 추가하여 공격을 막아내자.
- 바깥 클래스와 논리적으로 동일한 인스턴스를 반환하는 readResolve 메서드를 SerializationProxy 클래스에 추가한다. —> 역직렬화에 사용
    - 이는 가짜 바이트 스트림 공격과, 내부 필드 탈취 공격을 차단해준다.
    - 또한 final 필드도 지원한다.
- enum과도 잘어울린다.

### 한계

- 클라이언트가 멋대로 확장하는 클래스에는 적용할 수 없다.
- 객체 그래프에 순환이 있는 클래스에 적용할 수 없다.
- 방어적 복사보다 성능이 떨어진다.
