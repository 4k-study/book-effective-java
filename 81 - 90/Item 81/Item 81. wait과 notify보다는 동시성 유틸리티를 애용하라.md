# Item 81. wait과 notify보다는 동시성 유틸리티를 애용하라.

concurrent 패키지의 탄생으로 wait과 notify를 사용할 상황이 줄어들었다.

까다로운 조건을 지켜가며 wait과 notify를 쓰는 것보다 동시성 유틸리티를 사용하는 것이 쉽고 안전하기 때문이다.

동시성 컬렉션은 내부에서 동기화를 수행하기 때문에, 동시성을 무력화할 수 없다.

### 이러한 특성으로 인해 사용성이 달라진 부분이 있다.

- 여러 기본 동작을 하나의 동작으로 묶어 호출할 수 없다. → (상태 의존적 수정이 해결해준다)
- 당연한 말이지만, 외부에서 락을 사용할 필요가 없다.

### 동기화 방법

- **CountDownLatch + Semaphore : 카운트 랜치에 int 값으로 남은 메서드의 개수를 체크한다.**
- CycleBarrier + Exchanger : 대기하는 파티 수로 초기화하여 await 메서드를 호출한다
- Phaser : 동적으로 순환 장벽을 구성하여 동기화 한다.

### 주의점

- wait 메서드를 사용할 때 반드시 wait loop를 사용하라.
- wait 메서드는 반복문 외부에서 사용하지 않는다.
- 대기 조건이 충족되었다면, wait을 건너뛰자. 이는 응답 불가 상태를 예방한다.
- 대기 후 조건이 충족되지 않는다면 다시 대기하라. 이는 안전 실패를 예방한다.
- 일반적으로 notify보다 notifyAll을 사용하는 것이 더 안전하나, 관련 없는 스레드가 실수로 wait을 호출하기도 한다. (무한 대기 야기)
