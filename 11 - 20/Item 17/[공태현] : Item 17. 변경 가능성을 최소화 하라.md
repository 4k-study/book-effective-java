## 불변 클래스란?

<aside>
💡 인스턴스의 내부 값을 수정할 수 없는 클래스

</aside>

### 규칙

- 객체의 상태를 변경하는 메서드를 제공하지 않는다.
- 클래스를 확장할 수 없도록 한다.
    - 상속을 막는다.
- 모든 필드를 `private final`로 선언한다.
- 자신 외에는 내부의 가변 컴포넌트에 접근할 수 없도록 한다.
    - 내부 가변 컴포넌트가 `final`이라도 접근할 수 있으면 가변 컴포넌트의 값을 변경할 수 있음

### 장점

- 스레드 세이프하여 따로 동기화할 필요가 없다.
- 자주 사용되는 인스턴스를 캐싱하여 같은 인스턴스를 중복 생성하지 않게 해주는 정적 팩터리를 제공할 수 있다.
    - 메모리 사용량과 GC 비용이 감소함
- 방어적 복사도 필요 없음
    - `clone()` 메소드나 복사 생성자를 제공하지 않는게 좋다.
- 자유롭게 공유할 수 있고, 불변 객체끼리는 내부 데이터를 공유할 수 있다.
- 객체를 만들 때 다른 불변 객체들을 구성요소로 사용하면 좋다.
    - 객체 구조가 아무리 복잡하더라도 불변식을 유지하기 훨씬 수월하다.
- 메서드에서 예외가 발생한 후에도 객체는 여전히 유효한 상태이다. (= 실패원자성)

### 단점

- 값이 다르면 독립된 객체로 만들어야 한다.
    - 객체를 생성하기까지 다른 수많은 객체들을 생성해야 한다면 성능 문제가 발생할 수 있다.
        - 가변 동반 클래스를 둔다. (`String`과 `StringBuilder`)

### 불변 클래스와 상속

- 불변 클래스를 만드는 설계 방법 중 하나는 상속을 못하게 하는 것이다.
- 상속을 못하게 하려면 생성자를 `private`으로 두고 객체를 생성해야 한다면 정적 팩토리 메소드를 제공한다.

## 정리

- 무조건 Setter를 만들지 말자
- 클래스는 꼭 필요한 경우가 아니라면 불변이어야 한다.
- 값 객체는 항상 불변으로 만들자
- 무거운 값 객체는 불변으로 만들어야 하는지 고민하자
- 불변으로 만들 수 없는 클래스라도 변경할 수 있는 부분은 최소한으로 줄이자
- 다른 합당한 이유가 없다면 모든 필드는 `private final`이어야 한다.
- 생성자는 불변식 설정이 모두 완료된, 초기화가 완벽히 끝난 상태의 객체를 생성해야 한다.
